DROP TABLE IF EXISTS QuadCoreForumDBTest.Subjects;
DROP TABLE IF EXISTS QuadCoreForumDBTest.Threads;
DROP TABLE IF EXISTS QuadCoreForumDBTest.Messages;
DROP TABLE IF EXISTS QuadCoreForumDBTest.Members;

CREATE TABLE QuadCoreForumDBTest.Members (
  UserID BIGINT PRIMARY KEY,
  Username VARCHAR(20) NOT NULL,
  UserPassword VARCHAR(50) NOT NULL,
  Email VARCHAR(40) NOT NULL,
  FirstName VARCHAR(20),
  LastName VARCHAR(20),
  UserType ENUM('MEMBER', 'MODERATOR', 'ADMIN') NOT NULL DEFAULT 'MEMBER'
);

CREATE TABLE QuadCoreForumDBTest.UsersPermissions (
  UserID BIGINT,
  Permission ENUM('ADD_SUBJECT', 'DELETE_SUBJECT', 'OPEN_THREAD',
  'REPLY_TO_MESSAGE', 'DELETE_THREAD', 'DELETE_MESSAGE', 'EDIT_MESSAGE',
   'VIEW_ALL', 'ADD_SUB_SUBJECT', 'SET_MODERATOR', 'EDIT_SUBJECT'),
  FOREIGN KEY (UserID) REFERENCES Members(UserID) ON UPDATE CASCADE ON DELETE CASCADE,
  PRIMARY KEY(UserID, Permission)
);

CREATE TABLE QuadCoreForumDBTest.Messages(
  MessageID BIGINT PRIMARY KEY,
  AuthorID BIGINT,
  INDEX (AuthorID),
  Title VARCHAR(20) NOT NULL,
  Content TEXT NOT NULL,
  PostTime DATETIME NOT NULL,
  FatherID BIGINT DEFAULT -1,
  FOREIGN KEY (FatherID) REFERENCES Messages(MessageID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (AuthorID) REFERENCES Members(UserID)
);

CREATE TABLE QuadCoreForumDBTest.Subjects (
  SubjectID BIGINT PRIMARY KEY,
  FatherID BIGINT DEFAULT -1,
  lastAddedMessageID BIGINT,
  Name VARCHAR(20) NOT NULL,
  Description VARCHAR(30) NOT NULL,
  FOREIGN KEY (lastAddedMessageID) REFERENCES Messages(MessageID),
  FOREIGN KEY (FatherID) REFERENCES Subjects(SubjectID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE QuadCoreForumDBTest.Threads(
  ThreadID BIGINT PRIMARY KEY,
  Topic VARCHAR(20),
  StartMessageID BIGINT DEFAULT -1,
  LastMessageID BIGINT DEFAULT -1,
  NumOfViews BIGINT DEFAULT 0,
  NumOfResponses BIGINT DEFAULT 0,
  FatherSubjectID BIGINT DEFAULT -1,
  FOREIGN KEY (FatherSubjectID) REFERENCES Subjects(SubjectID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (StartMessageID) REFERENCES Messages(MessageID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (LastMessageID) REFERENCES Messages(MessageID) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE QuadCoreForumDBTest.Replies (
  FatherID BIGINT,
  ReplyID BIGINT,
  FOREIGN KEY (FatherID) REFERENCES Messages(MessageID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (ReplyID) REFERENCES Messages(MessageID) ON UPDATE CASCADE ON DELETE CASCADE,
  PRIMARY KEY(FatherID, ReplyID)
);

CREATE TABLE QuadCoreForumDBTest.SubSubjects (
  FatherID BIGINT,
  SubSubjectID BIGINT,
  FOREIGN KEY (FatherID) REFERENCES Subjects(SubjectID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (SubSubjectID) REFERENCES Subjects(SubjectID) ON UPDATE CASCADE ON DELETE CASCADE,
  PRIMARY KEY(FatherID, SubSubjectID)
);

CREATE TABLE QuadCoreForumDBTest.SubjectsThreads (
  SubjectID BIGINT,
  ThreadID BIGINT,
  FOREIGN KEY (SubjectID) REFERENCES Subjects(SubjectID) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (ThreadID) REFERENCES Threads(ThreadID) ON UPDATE CASCADE ON DELETE CASCADE,
  PRIMARY KEY(SubjectID, ThreadID)
);

INSERT INTO QuadCoreForumDBTest.subjects(SubjectID, Name, Description)
VALUES(-1, "name", "description");

INSERT INTO QuadCoreForumDBTest.members
VALUES(-1, "2SeU4E1NaMeU", "password", "email@email", "first", "last", 'MEMBER');

INSERT INTO QuadCoreForumDBTest.messages(MessageID, AuthorID, Title, Content, PostTime)
VALUES(-1, -1, "title", "content", '10/10/10 15:14');

INSERT INTO QuadCoreForumDBTest.threads(ThreadID, topic, StartMessageID, LastMessageID)
VALUES(-1, "topic", -1, -1);

INSERT INTO QuadCoreForumDBTest.messages(MessageID, AuthorID, Title, Content, PostTime)
VALUES(104, -1, "title", "content", '10/10/10 15:14');